[Unit]
Description=Webapp Backend (Flask + PySpark) for Top Routes API
After=network.target spark-master.service
Wants=spark-master.service

[Service]
Type=simple
User={{ backend_user }}
Group={{ backend_user }}
WorkingDirectory={{ backend_home }}

# ============================================================
# Umgebungsvariablen f√ºr backend-services.py
# ============================================================
Environment="SPARK_MASTER={{ spark_master }}"
Environment="SPARK_HOME={{ spark_home }}"
Environment="SOLR_HOST={{ solr_host }}"
Environment="SOLR_PORT={{ solr_port }}"
Environment="BACKEND_PORT={{ backend_port }}"
Environment="DEBUG=false"

# PySpark Konfiguration
Environment="PYSPARK_PYTHON=/usr/bin/python3"
Environment="PYSPARK_DRIVER_PYTHON={{ backend_home }}/venv/bin/python"
Environment="JAVA_HOME={{ java_home }}"

ExecStart={{ backend_home }}/venv/bin/python {{ backend_home }}/backend_services.py
Restart=always
RestartSec=10

# Logging
StandardOutput=append:{{ backend_home }}/logs/backend.log
StandardError=append:{{ backend_home }}/logs/backend.log

# Resource limits
LimitNOFILE=65536
LimitNPROC=65536

[Install]
WantedBy=multi-user.target
